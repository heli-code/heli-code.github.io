# MusicFlow 前后端集成指南

## 🎯 已完成的任务

### 1. 前端代理配置 ✅
- **配置文件**: `vite.config.ts`
- **代理设置**: 将 `/api` 路径代理到 `http://localhost:8080`
- **解决跨域**: 开发环境下的跨域问题已解决

### 2. 前后端数据格式统一 ✅
- **后端响应格式**: 统一的 `ApiResponse<T>` 格式
  ```json
  {
    "success": true,
    "message": "操作成功",
    "data": {}
  }
  ```

- **前端API适配**: 在 `src/utils/api.ts` 中配置响应拦截器
- **数据映射**: 自动提取 `response.data.data` 作为实际数据

### 3. 用户认证服务完善 ✅
- **认证服务**: `src/services/authService.ts`
- **状态管理**: `src/stores/user.ts`
- **接口定义**: 完整的登录、注册、获取用户信息接口

### 4. 测试页面创建 ✅
- **测试页面**: `src/views/AuthTestView.vue`
- **路由配置**: 添加 `/auth-test` 路由
- **功能测试**: 完整的注册、登录、获取用户信息测试

## 🚀 启动和测试步骤

### 第一步：启动后端服务
```bash
cd backend
mvn spring-boot:run
```

### 第二步：启动前端服务
```bash
npm run dev
```

### 第三步：测试连接
```bash
node test-connection.js
```

### 第四步：访问测试页面
打开浏览器访问：`http://localhost:5173/auth-test`

## 📊 测试流程

### 1. 用户注册测试
- 输入用户名、邮箱、密码
- 点击"测试注册"按钮
- 观察注册结果和状态变化

### 2. 用户登录测试
- 使用注册的用户名和密码
- 点击"测试登录"按钮
- 验证token和用户信息存储

### 3. 获取用户信息测试
- 点击"获取用户信息"按钮
- 验证用户信息是否正确返回

### 4. 状态监控
- 实时显示当前认证状态
- 显示token和用户信息状态

## 🔧 技术实现细节

### 前端代理配置
```typescript
// vite.config.ts
proxy: {
  '/api': {
    target: 'http://localhost:8080',
    changeOrigin: true,
    rewrite: (path) => path.replace(/^\/api/, '')
  }
}
```

### 数据格式统一
```typescript
// API响应拦截器
api.interceptors.response.use(
  (response) => {
    if (response.data && response.data.success === true) {
      return response.data.data  // 提取实际数据
    } else {
      return Promise.reject(new Error(response.data?.message || '请求失败'))
    }
  }
)
```

### 错误处理机制
- **网络错误**: 自动重试机制
- **认证错误**: 自动跳转到登录页
- **权限错误**: 友好的错误提示

## 🐛 常见问题排查

### 问题1：后端连接失败
**症状**: 前端显示网络错误
**解决**: 
1. 检查后端服务是否启动
2. 确认端口8080未被占用
3. 检查数据库连接配置

### 问题2：跨域错误
**症状**: 浏览器控制台显示CORS错误
**解决**: 
1. 确认前端代理配置正确
2. 检查后端CORS配置
3. 重启前端开发服务器

### 问题3：数据格式不匹配
**症状**: 前端无法解析后端响应
**解决**: 
1. 检查后端ApiResponse格式
2. 确认前端响应拦截器配置
3. 查看浏览器网络请求详情

## 📈 下一步计划

### 短期目标
1. ✅ 完成基础认证流程测试
2. 🔄 完善错误处理和用户反馈
3. 🔄 添加加载状态和进度指示

### 中期目标
1. 🔄 集成音乐播放功能
2. 🔄 实现社交功能
3. 🔄 添加AI助手功能

### 长期目标
1. 🔄 性能优化和代码分割
2. 🔄 移动端适配
3. 🔄 部署和上线

## 📞 技术支持

如果遇到问题，请检查：
1. 控制台错误信息
2. 网络请求状态
3. 后端服务日志
4. 数据库连接状态

---

**文档版本**: v1.0  
**最后更新**: 2024-10-29  
**维护者**: MusicFlow开发团队